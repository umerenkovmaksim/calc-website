# Распределённый вычислитель арифметических выражений

Данный проект представляет собой распределённый вычислитель арифметических выражений на языке Go. Особенность системы в том, что каждая арифметическая операция (сложение, вычитание, умножение, деление) выполняется "очень-очень" долго, что требует распределения вычислительных задач между отдельными компонентами.

---
## Использование

Для использования проекта можно использовать API, которое после запуска проекта будет находиться на http://localhost:8080, либо использовать графическую оболочку, которая находится на http://localhost:3000

- **Отправка выражения на вычисление:**

    ```bash
    curl --location 'localhost:8080/api/v1/calculate' \
    --header 'Content-Type: application/json' \
    --data '{"expression": "2 + 2 * 2"}'
    ```


- **Получение статуса и результата вычисления:**

    ```bash
    curl --location 'localhost:8080/api/v1/expressions'
    ```

  или по конкретному идентификатору:

    ```bash
    curl --location 'localhost:8080/api/v1/expressions/<id>'
    ```
---
## Установка и запуск

### Требования
1. Установлен Docker: [Инструкция по установке Docker](https://docs.docker.com/engine/install/)
2. Установлен Git: [Инструкция по установке Git](https://git-scm.com/book/ru/v2/%D0%92%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5-%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0-Git)

### Клонирование репозитория
```bash
git clone https://github.com/umerenkovmaksim/calc-website
cd calc-website
```


### Запуск

```bash
docker compose up --build
```

Перед запуском убедитесь, что переменные окружения настроены корректно.

---

## Архитектура проекта

Система состоит из двух основных компонентов:

1. **Оркестратор (Server)**  
   Отвечает за:

    - Приём арифметических выражений.
    - Разбиение выражения на последовательность вычислительных задач.
    - Управление порядком выполнения операций.
    - Обслуживание запросов пользователей для получения статуса вычислений.
2. **Агент (Worker)**  
   Отвечает за:

    - Постоянное обращение к оркестратору для получения задач.
    - Выполнение арифметических операций.
    - Отправку результата обратно в оркестратор.

Каждая операция требует значительных вычислительных мощностей, поэтому система масштабируется добавлением новых агентов, способных выполнять операции параллельно.

---

## API Оркестратора

### 1. Добавление вычисления арифметического выражения

**Запрос:**

```bash
curl --location 'localhost:8080/api/v1/calculate' \
--header 'Content-Type: application/json' \
--data '{
  "expression": "<строка с выражением>"
}'

```

**Ответ:**

- **201** — выражение принято для вычисления.
- **422** — невалидные данные.
- **500** — внутренняя ошибка сервера.

```json
{
  "id": "<уникальный идентификатор выражения>"
}
```
---

### 2. Получение списка выражений

**Запрос:**

```bash
curl --location 'localhost:8080/api/v1/expressions'
```
**Ответ:**

- **200** — успешно получен список выражений.
- **500** — ошибка сервера.

```json
{
  "expressions": [
    {       
      "id": "<идентификатор выражения>",       
      "status": "<статус вычисления>",       
      "result": 0     
    }
  ]
}
```

---

### 3. Получение выражения по идентификатору

**Запрос:**

```bash
curl --location 'localhost:8080/api/v1/expressions/:id'
```
**Ответ:**

- **200** — выражение получено.
- **404** — выражение с указанным идентификатором не найдено.
- **500** — ошибка сервера.

```json
{
  "expression": {
    "id": "<идентификатор выражения>",     
    "status": "<статус вычисления>",     
    "result": 0
  }
}
```

---

### 4. Получение задачи для выполнения

**Запрос:**

```bash
curl --location 'localhost:8080/internal/task'
```
**Ответ:**

- **200** — задача получена.
- **404** — задач нет.
- **500** — ошибка сервера.

```json
{
  "task": {
    "id": "<идентификатор задачи>",     
    "arg1": 0,     
    "arg2": 0,     
    "operation": "<операция (+, -, *, /)>",     
    "operation_time": 0
  }
}
```

---

### 5. Прием результата обработки задачи

**Запрос:**

```bash
curl --location 'localhost:8080/internal/task' \
--header 'Content-Type: application/json' \
--data '{
  "id": <идентификатор задачи>,   
  "result": <вычисленный результат>
}'
```

**Ответ:**

- **200** — результат успешно записан.
- **404** — задача с указанным идентификатором не найдена.
- **422** — невалидные данные.
- **500** — ошибка сервера.

---

## Агент (Worker)

Агент представляет собой демон, который:

- При старте запускает несколько горутин, каждая из которых действует как независимый вычислитель.
- Количество параллельных горутин регулируется переменной окружения `COMPUTING_POWER`.
- Постоянно запрашивает у оркестратора новые задачи через GET-запрос к эндпоинту `/internal/task`.
- Вычисляет полученную задачу и отправляет результат обратно на сервер через POST-запрос к тому же эндпоинту.

---

## Конфигурация

Для корректной работы системы необходимо настроить следующие переменные окружения:

- **TIME_ADDITION_MS** — время выполнения операции сложения (в мс).
- **TIME_SUBTRACTION_MS** — время выполнения операции вычитания (в мс).
- **TIME_MULTIPLICATIONS_MS** — время выполнения операции умножения (в мс).
- **TIME_DIVISIONS_MS** — время выполнения операции деления (в мс).
- **COMPUTING_POWER** — количество горутин, запускаемых агентом для параллельных вычислений.


Пример настройки переменных:

```bash
export TIME_ADDITION_MS=1000 
export TIME_SUBTRACTION_MS=1000 
export TIME_MULTIPLICATIONS_MS=1500 
export TIME_DIVISIONS_MS=1500 
export COMPUTING_POWER=4
```
---
